# ios/Podfile

platform :ios, '15.1'  # Expo SDK 53+ minimum

# 1) Expo autolinking
require File.join(
  File.dirname(`node --print "require.resolve('expo/package.json')"`),
  "scripts/autolinking"
)

# 2) React Native autolinking
require File.join(
  File.dirname(`node --print "require.resolve('react-native/package.json')"`),
  "scripts/react_native_pods"
)

# (Removed the @react-native-community/cli-platform-ios/native_modules require)

require 'json'
podfile_properties = JSON.parse(
  File.read(File.join(__dir__, 'Podfile.properties.json'))
) rescue {}

install! 'cocoapods', deterministic_uuids: false
prepare_react_native_project!

target 'Voltuoso' do
  use_expo_modules!                    # Expo Modules (expo-dev-menu, expo-modules-core, etc.)
  config = use_native_modules!         # Other RN community modules

  use_react_native!(
    path:           config[:reactNativePath],
    hermes_enabled: podfile_properties['expo.jsEngine'] != 'jsc',
    fabric_enabled: podfile_properties['expo.jsEngine'] != 'jsc'
  )

  post_install do |installer|
    # Standard React Native + Expo fixes
    react_native_post_install(installer)
    # (No DEFINES_MODULE tweak here)
  end

  post_integrate do |installer|
    begin
      expo_patch_react_imports!(installer)
    rescue => e
      Pod::UI.warn e
    end
  end
end
